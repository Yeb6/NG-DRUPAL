name: Black Duck Detect â€“ Boot Diagnostics

on:
  workflow_dispatch:

jobs:
  detect-boot-debug:
    name: Detect Boot Debug (No Scan)
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # ---- Minimal runtime dependencies ----
      - name: Install minimal prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y curl unzip default-jre

      # ---- Network Proof ----
      - name: Network diagnostics (Black Duck endpoints)
        run: |
          echo "=== DNS CHECK ==="
          nslookup repo.blackduck.com || true
          nslookup detect.synopsys.com || true
          echo
          echo "=== HTTPS HEAD CHECK ==="
          curl -Iv https://repo.blackduck.com || true
          curl -Iv https://detect.synopsys.com || true

      # # ---- Download Detect Script ----
      # - name: Download Detect launcher
      #   run: |
      #     curl -v -L https://detect.synopsys.com/detect.sh -o detect.sh
      #     chmod +x detect.sh

      - name: Download Black Duck Detect JAR (OFFICIAL)
        run: |
          mkdir -p $HOME/blackduck
          curl -fL \
            https://repo.blackduck.com/bds-integrations-release/com/synopsys/integration/synopsys-detect/9.9.0/synopsys-detect-9.9.0.jar \
            -o $HOME/blackduck/detect.jar
          file $HOME/blackduck/detect.jar
          ls -lh $HOME/blackduck/detect.jar


      # ---- Inspect downloaded file (CRITICAL PROOF) ----
      # - name: Inspect downloaded detect.sh
      #   run: |
      #     echo "==== FIRST 20 LINES ===="
      #     head -n 20 detect.sh || true
      #     echo
      #     echo "==== FILE TYPE ===="
      #     file detect.sh || true

      # ---- Detect BOOT ONLY (no auth, no scan) ----
      # - name: Run Detect (BOOT DEBUG ONLY)
      #   run: |
      #     ./detect.sh \
      #       --logging.level.com.synopsys.integration=DEBUG \
      #       --detect.tools=NONE \
      #       --detect.source.path=. \
      #       --detect.cleanup=false \
      #       --blackduck.offline.mode=true || true

      - name: Detect BOOT diagnostics (NO SCAN)
        run: |
          java -jar $HOME/blackduck/detect.jar \
            --logging.level.com.synopsys.integration=DEBUG \
            --detect.tools=DETECTOR,SIGNATURE_SCAN \
            --detect.source.path=. \
            --detect.cleanup=false \
            --blackduck.offline.mode=true || true


