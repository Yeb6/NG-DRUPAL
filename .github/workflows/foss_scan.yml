name: Black Duck Detect â€“ Boot Diagnostics

on:
  workflow_dispatch:

jobs:
  detect-boot-debug:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install minimal prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y curl unzip java-common

      # ---- Network Proof ----
      - name: Network diagnostics (Black Duck endpoints)
        run: |
          echo "=== DNS ==="
          nslookup repo.blackduck.com || true
          nslookup detect.synopsys.com || true

          echo "=== HTTPS HEAD ==="
          curl -Iv https://repo.blackduck.com || true
          curl -Iv https://detect.synopsys.com || true

      # ---- Download Detect Script ----
      - name: Download Detect launcher
        run: |
          curl -v -L https://detect.synopsys.com/detect.sh -o detect.sh
          chmod +x detect.sh
          head -n 5 detect.sh || true

      # ---- Detect BOOT ONLY (no auth, no scan) ----
      - name: Run Detect (BOOT DEBUG ONLY)
        run: |
          ./detect.sh \
            --logging.level.com.synopsys.integration=DEBUG \
            --detect.tools=NONE \
            --detect.source.path=. \
            --detect.cleanup=false \
            --blackduck.offline.mode=true || true
